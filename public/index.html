<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@300;400;500&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="./style.css">
    <title>Screenshot API</title>
</head>

<body>
    <div id="main">
    <div class="heading">
        <h1>Website Screenshot </h1>
        <p>Url to Screenshot</p>
    </div>
    <form action="javascript:void(0);" onsubmit="myFunction()">
        <div class="top">
            <input id="url" class="inputtext" type="text" pattern="[(http(s)?):\/\/(www\.)?a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)" name="url" placeholder="Enter the Url to Take Screenshot" required>
            <button class="submitBtn" type="submit">Download</button></div>
        <div class="toggleSwitch">
            <div class="divLeft">
                <p>Default</p></div>
            <div class="divcenter"> <label class="switch">
            <input id="full" type="checkbox" value="1" name="full">
            <span class="slider round"></span>
            </label></div>
            <div class="divright">
                <p>FullPage</p></div>
        </div>
    </form>
    <div>
        <div><a id="link" href="" download="Screenshot.png"><button id="link__button">Download Screenshot</button></a></div>
        <div><h1 id="error">Something went Wrong ☹️ Please try Again Later</h1></div>
       <div><img id="image" src="" width="70%"></img></div>
    </div>
</div>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
    <script>  
       $(document).ready(function(){
            $('#error').hide()
            $('#link').hide()  
            $('#image').hide() 
        })
        $('.submitBtn').click(function(){
            $('#error').hide()
            $('#link').hide()
            $('#image').hide()
        })
        function myFunction() {
            var url = ($("#url").val())
            url = url.replace(/(^\w+:|^)\/\//, '');
            var fullpage = $("#full").is(':checked');
            var d = new Date();
            var n = d.getTime();
            let fullFileName = url + '-' + n + '.png'
                // document.getElementById('image').src = 'api/?' + 'url=' + url + '&fullpage=' + fullpage;
            fetch('api/?url=' + url + '&fullpage=' + fullpage).then(response => response.json())
            .then(data => {console.log(data)
                $('#error').hide()
                $('#link').attr('download', fullFileName)
                document.getElementById('image').src = data.imageurl;
                document.getElementById('link').href = data.imageurl;
                $('#link').show()
                 $('#image').show()
                })
            .catch(error => {
                console.log(error)
                $('#link').hide()
                $('#error').show()});
        };
    </script>

</body>

</html>